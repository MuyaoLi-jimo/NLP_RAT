"""
注：只作为pre展示用，不是真实输出结果
"""

import time
import gradio as gr

draft = """
**draft**:
【解析】 
A. 氯气在饱和食盐水中的溶解度小于在纯水中的溶解度。这是因为食盐水中的氯离子会与氯气形成竞争，减少氯气的溶解度。这个说法是正确的。
B. 碘在碘化钾溶液中的溶解度大于在纯水中的溶解度。这是因为碘化钾可以与碘形成I3-离子，增加了碘的溶解度。这个说法是正确的。
C. 醋酸在醋酸钠溶液中电离的程度大于在纯水中电离的程度。这是因为醋酸钠的加入会增加溶液中的醋酸根离子浓度，根据勒夏特列原理，这会促进醋酸的电离。这个说法是正确的。
D. 工业上生产硫酸的过程中使用过量的空气可提高SO2的利用率。这个说法是错误的。实际上，使用过量的空气会稀释反应物，降低反应速率和SO2的利用率。
综上所述，错误的选项是D。
<eoe>
【答案】 D <eoa>
"""
split = """ 
**split**:  
【解析】
~~~~~~~~ 
A. 氯气在饱和食盐水中的溶解度小于在纯水中的溶解度。这是因为食盐水中的氯离子会与氯气形成竞争，减少氯气的溶解度。这个说法是正确的。
~~~~~~~~ 
B. 碘在碘化钾溶液中的溶解度大于在纯水中的溶解度。这是因为碘化钾可以与碘形成I3-离子，增加了碘的溶解度。这个说法是正确的。
~~~~~~~~ 
C. 醋酸在醋酸钠溶液中电离的程度大于在纯水中电离的程度。这是因为醋酸钠的加入会增加溶液中的醋酸根离子浓度，根据勒夏特列原理，这会促进醋酸的电离。这个说法是正确的。
~~~~~~~~ 
D. 工业上生产硫酸的过程中使用过量的空气可提高SO2的利用率。这个说法是错误的。实际上，使用过量的空气会稀释反应物，降低反应速率和SO2的利用率。
~~~~~~~~ 
综上所述，错误的选项是D。
<eoe>
【答案】 D <eoa>
"""
step1_q="""
**step1**:  
pass
"""
step2_q="""
**step2**:
A. 氯气在饱和食盐水中的溶解度小于在纯水中的溶解度。这是因为食盐水中的氯离子会与氯气形成竞争，减少氯气的溶解度。这个说法是正确的。
"""
step2_ref="""
**retrieve**:
元素及其化合物 · 六 · 「氯 $(\\ce{Cl})$ 与卤族元素」\n\n氯 $\\ce{Cl}$\n\n氯气\n\n物理性质\n\n黄绿色 气体，有刺激性气味，可溶于水，密度大于空气，沸点比气体高，易液化，有毒\n\n闻氯气气味的方法：抽去盛氯气的集气瓶口处的毛玻璃片，用手掌在瓶口上方轻轻扇动，使少量氯气飘进鼻孔\n\n化学性质\n\n氯气与氢气反应： $\\ce{H2 + Cl2 \\xlongequal{点燃} 2HCl}$\n\n氢气在氯气中安静地燃烧，发出苍白色的火焰，瓶口出现白雾\n\n工业制 $\\ce{HCl}$ 时采用点燃法，工业浓 $\\ce{HCl}$ 常显黄色，是因为含 $\\ce{Fe^3+}$\n\n氯气与金属单质反应\n\n$\\ce{2Fe + 3Cl2 \\xlongequal{点燃} 2FeCl3}$\n\n产生黄色火焰，棕褐色烟雾\n\n与反应物的量无关（$\\ce{Fe^3+->[Fe]Fe^2+}$ 只发生在氯化铁溶液中）\n\n氧化性从高到低排列为：$\\ce{Cl2}$ > $\\ce{O2}$ > $\\ce{S}$\n\n$\\ce{Cl2}$ 与 $\\ce{Fe}$ 反应生成 $\\ce{FeCl3}$
"""
step2_refine="""
**refine answer**
A. 氯气在饱和食盐水中的溶解度小于在纯水中的溶解度。这是因为食盐水中的氯离子会与氯气形成竞争，减少氯气的溶解度。这个说法是正确的。
"""
step3_q="""
**step3**:
B. 碘在碘化钾溶液中的溶解度大于在纯水中的溶解度。这是因为碘化钾可以与碘形成I3-离子，增加了碘的溶解度。这个说法是正确的。
"""
step3_ref="""
**retrieve**:
和纯碱溶液，这是因为生成了易溶性的钠盐。 ③乙酸乙酯在饱和碳酸钠溶液中更加难溶，同时饱和碳酸钠溶液还能通过反应吸收挥发出的乙酸，溶解吸 收挥发出的乙醇，便于闻到乙酸乙酯的香味。 ④有的淀粉、蛋白质可溶于水形成胶体。蛋白质在浓轻金属盐(包括铵盐)溶液中溶解度减小，会析出(即盐 析，皂化反应中也有此操作)。但在稀轻金属盐(包括铵盐)溶液中，蛋白质的溶解度反而增大。 ⑤线型和部分支链型高聚物可溶于某些有机溶剂，而体型则难溶于有机溶剂。 ⑥氢氧化铜悬浊液可溶于多羟基化合物的溶液中，如甘油、葡萄糖溶液等，形成绛蓝色溶液。 六、常考物质的密度 1.同族元素单质一般密度从上到下增大，但 K<Na。 2.气体密度大小由相对分子质量大小决定。 3.有机物的密度 (1)小于水的密度，且与水(溶液)分层的有：各类烃、一氯代烃、酯(包括油脂)。 (2)大于水的密度，且与水(溶液)分层的有：多氯代烃、溴代烃(溴苯等)、碘代烃、硝基苯。 4.钠的密度小于水，大于酒精、苯。 小结：(1)密度比水轻的：苯、甲苯、乙醇、氨水、乙酸乙酯、油脂、Na、K。
"""
step3_refine="""
**refine answer**:  
B. 碘在碘化钾溶液中的溶解度大于在纯水中的溶解度。这是因为碘化钾可以与碘形成I3-离子，增加了碘的溶解度。这个说法是正确的
"""
step4_q="""
**step4**:
C. 醋酸在醋酸钠溶液中电离的程度大于在纯水中电离的程度。这是因为醋酸钠的加入会增加溶液中的醋酸根离子浓度，根据勒夏特列原理，这会促进醋酸的电离。这个说法是正确的。
"""
step4_ref="""
**retrieve**:
和纯碱溶液，这是因为生成了易溶性的钠盐。 ③乙酸乙酯在饱和碳酸钠溶液中更加难溶，同时饱和碳酸钠溶液还能通过反应吸收挥发出的乙酸，溶解吸 收挥发出的乙醇，便于闻到乙酸乙酯的香味。 ④有的淀粉、蛋白质可溶于水形成胶体。蛋白质在浓轻金属盐(包括铵盐)溶液中溶解度减小，会析出(即盐 析，皂化反应中也有此操作)。但在稀轻金属盐(包括铵盐)溶液中，蛋白质的溶解度反而增大。 ⑤线型和部分支链型高聚物可溶于某些有机溶剂，而体型则难溶于有机溶剂。 ⑥氢氧化铜悬浊液可溶于多羟基化合物的溶液中，如甘油、葡萄糖溶液等，形成绛蓝色溶液。
"""
step4_refine="""
**refine answer**:  
C. 醋酸在醋酸钠溶液中电离的程度大于在纯水中电离的程度。这是因为醋酸钠的加入会增加溶液中的醋酸根离子浓度，根据勒夏特列原理，这会抑制醋酸的电离。这个说法是错误的。
"""
step5_q="""
**step5**:
D. 工业上生产硫酸的过程中使用过量的空气可提高SO2的利用率。这个说法是错误的。实际上，使用过量的空气会稀释反应物，降低反应速率和SO2的利用率。
"""
step5_ref="""
**retrieve**:
(3)用过量盐酸溶解废铁屑的原因:盐酸不仅可与废铁屑反应,还可以抑制 Fe2+水解,防止生成 Fe(OH)2 沉淀。
"""
step5_refine="""
**refine answer**:  
D. 工业上生产硫酸的过程中使用过量的空气可提高SO2的利用率。这个说法是正确的。在硫酸生产过程中，使用过量的空气可以确保SO2完全氧化为SO3，从而提高SO2的利用率。
"""
step6_q="""
**step6**:
pass
"""
final="""
**总结**:  
【分析】  
A. 氯气在饱和食盐水中的溶解度小于在纯水中的溶解度。这是因为食盐水中的氯离子会与氯气形成竞争，减少氯气的溶解度。这个说法是正确的。  
B. 碘在碘化钾溶液中的溶解度大于在纯水中的溶解度。这是因为碘化钾可以与碘形成I3-离子，增加了碘的溶解度。这个说法是正确的。
C. 醋酸在醋酸钠溶液中电离的程度大于在纯水中电离的程度。这是因为醋酸钠的加入会增加溶液中的醋酸根离子浓度，根据勒夏特列原理，这会抑制醋酸的电离。这个说法是错误的。
D. 工业上生产硫酸的过程中使用过量的空气可提高SO2的利用率。这个说法是正确的。在硫酸生产过程中，使用过量的空气可以确保SO2完全氧化为SO3，从而提高SO2的利用率。  
<eoe>  
【答案】 C <eoa>
"""

def slow_echo(message, history):
    my_history = [
        draft,
        split,
        step1_q,
        step2_q,
        step2_ref,
        step2_refine,
        step3_q,
        step3_ref,
        step3_refine,
        step4_q,
        step4_ref,
        step4_refine,
        step5_q,
        step5_ref,
        step5_refine,
        step6_q,
        final,
    ]
    if history is None:
        len_history = 0
    else:
        len_history = len(history)//2
        print(len(history))
    output = my_history[len_history]
    for i in range(len(output)):
        time.sleep(0.05)
        yield output[: i + 1]

demo = gr.ChatInterface(slow_echo, type="messages")

if __name__ == "__main__":
    demo.launch()